- trigger:
    - platform: time_pattern
      hours: "/4"
    - platform: homeassistant
      event: start
    - platform: event
      event_type: event_template_reloaded
  action:
    - service: environment_canada.get_forecasts
      target:
        entity_id: weather.nanaimo_forecast
      response_variable: forecasts
  sensor:
    - name: Weather Forecast Daily
      unique_id: weather_forecast_daily
      state: "{{ states('weather.nanaimo_forecast') }}"
      attributes:
        daily: "{{ forecasts['weather.nanaimo_forecast']['daily_forecast'] }}"
        hourly: "{{ forecasts['weather.nanaimo_forecast']['hourly_forecast'] }}"
        summary: "{{ forecasts['weather.nanaimo_forecast']['daily_forecast'][0]['text_summary'] }}"
        temperature_unit: "{{ state_attr('weather.nanaimo_forecast', 'temperature_unit') }}"
